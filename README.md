# "Автоматизация тестирования консольных приложений Linux на Python"
### Семинар - 1 Тестирование cli в linux без использования фреймворков:

*Задача_2:*

Написать автотест на bash, который читает содержимое файла
/etc/os-release (в нем хранится информация о версии системы)
и выведет на экран “SUCCESS” если в нем содержатся версия
22.04.1, кодовое имя jammy и команда чтения файла выполнена
без ошибок. В противном случае должно выводится “FAIL”.
- Переписать тест на Python c использованием модуля subprocess.

*Задача_3:*

Доработать тест из предыдущего задания таким образом,
чтобы вывод сохранялся построчно в список и в тесте проверялось,
что в этом списке есть строки VERSION="22.04.1 LTS (Jammy
Jellyfish)" и VERSION_CODENAME=jammy . Проверка должна
выполняться только если код возврата равен 0.

*Задача_4_ДЗ:*

- Задание 1.

Написать функцию на Python, которой передаются в качестве параметров команда и текст.
Функция должна возвращать True, если команда успешно выполнена и текст найден в ее выводе
и False в противном случае. Передаваться должна только одна строка, разбиение вывода
использовать не нужно.

*Задача_5_ДЗ:*

- Задание 2. (повышенной сложности).

Доработать функцию из предыдущего задания таким образом,
чтобы у нее появился дополнительный режим работы, в котором вывод разбивается на слова
с удалением всех знаков пунктуации (их можно взять из списка string.punctuation модуля string).
В этом режиме должно проверяться наличие слова в выводе.

### Семинар - 2 Создание первых тестов на pytest:

*Задача_1:*

- Установить пакет pip3, выполнив в терминале команду:
- #### sudo apt install python3-pip
- Установить пакет pytest командой
- #### sudo pip3 install pytest
- Установить консольный архиватор командой
- #### sudo apt install p7zip-full


Выполнить тесты

![Выполнить код](Screenshot_code_1.png "Выполнить код")



*Задача_2:*

Добавить в проект тесты, проверяющие работу команд
d (удаление из архива) и u (обновление архива).
Вынести в отдельные переменные пути к папкам с файлами, с архивом
и с распакованными файлами. Выполнить тесты с ключом -v.

*Задача_3:*

Создать отдельный файл для негативных тестов. Функцию
проверки вынести в отдельную библиотеку. Повредить архив
(например, отредактировав его в текстовом редакторе).
Написать негативные тесты работы архиватора с командами
распаковки (e) и проверки (t) поврежденного архива.

*Задача_4:*

Доработать позитивные тесты таким образом, чтобы при архивации дополнительно
проверялось создание файла архива, а при распаковке проверялось создание файлов.

*Задача_5_ДЗ:*

- Задание 1.

Дополнить проект тестами, проверяющими команды вывода списка файлов (l)
и разархивирования с путями (x).
- Задание 2.

Установить пакет для расчета crc32
- #### sudo apt install libarchive-zip-perl
Доработать проект, добавив тест команды расчета хеша (h). Проверить, что хеш
совпадает с рассчитанным командой crc32.

### Семинар - 3 Использование фикстур в pytest. Создание отчетов о тестировании:

*Подготовка:*

- Установить пакет yaml командой
- #### sudo pip3 install pyyaml (или через IDE Pycharm)
- Установить модули для отчетности командами
- #### sudo pip3 install pytest-html
- #### sudo pip3 install pytest-html-reporter

*Задача_1:*

- Доработать проект из прошлого семинара так, как это было сделано в лекции.
- Для этого можно использовать видеозапись лекции. Запустить тесты, получить отчеты.

*Задача_2:*

- Доработать негативные тесты, написанные на прошлом семинаре, вынеся пути к каталогам в отдельный файл.
- Оформить их как класс.
- Подключить к тестам уже написанную фикстуру, создающую каталоги.
- Написать фикстуру, создаюшую перед шагом теста битый архив и удаляющую его после завершения шага теста.
Битый архив можно создать используя команду усечения файла __truncate -s 1 file__

*Задача_3:*

- Вынести в конфигурационный файл размер создаваемого фикстурой make_files файла (параметр bs).
- Провести тесты для пяти файлов размером: 1Мб, 2Мб, 5Мб, 10Мб.
- Сравнить по отчету время прохождения тестов.
- Составить сравнительную таблицу.
- Проверить, тесты на каком наборе файлов пройдут быстрее: 5 по 2 Мб или 2 по 5 Мб.

*Задача_4_ДЗ:*

Задание 1.
- Дополнить проект фикстурой, которая после каждого шага теста дописывает
в заранее созданный файл stat.txt строку вида:
время, кол-во файлов из конфига, размер файла из конфига, статистика загрузки процессора
из файла /proc/loadavg (можно писать просто все содержимое этого файла).

Задание 2.
- Дополнить все тесты ключом команды 7z -t (тип архива). Вынести этот параметр в конфиг

### Семинар - 4 Реализации автодеплоя и тестов по SSH:

*Подготовка:*

1. Установить пакет openssh-server командой
- #### sudo apt install openssh-server
2. Включить сервис
- #### sudo systemctl enable sshd или (sudo systemctl start sshd) команда для проверки сервиса (sudo systemctl status sshd)
3. Создать пользователя
- #### sudo useradd user2 -m
4. Задать ему пароль
- #### sudo passwd user2
5. Выдать пользователю права суперпользователя
- #### sudo usermod -aG sudo user2

Самостоятельно воспроизвести автодеплой, написанный в лекции

*Задача_3:*

Добавить установку к тестам
- Добавить установку как первый тестовый шаг, название пакета, имя пользователя, адрес и пароль ssh вынести
в конфигурационный файл yaml.
- Запустить тесты, проверить работу.

*Задача_4:*

Добавить сохранение системных логов
- Добавить фикстуру, возвращающую время старта шага в формате, пригодном для journalctl
- Реализовать для каждого шага сохранение в текстовый файл фрагмента системного лога за время работы шага

*Задача_5:*

Реализовать удаление
- реализовать удаление установленного пакета как последний шаг теста

*Задача_6_ДЗ:*

Задание 1.
- Переделать все шаги позитивных тестов на выполнение по ssh. Проверить работу.

Задание 2. (дополнительное)
- Переделать все шаги негативных тестов на выполнение по ssh. Проверить работу.
